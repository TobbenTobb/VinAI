version: "3.1"
rules:
- rule: Saludar al usuario
  steps:
  - intent: saludar
  - action: utter_saludar

- rule: Despedirse del usuario
  steps:
  - intent: despedirse
  - action: utter_despedirse

- rule: Activar la recomendación de vino
  steps:
  - intent: recomendar_vino
  - action: action_recomendar_vino_db

- rule: Dar recomendación DESPUÉS de informar gusto
  steps:
  - intent: informar_gusto
  - action: action_recomendar_vino_db

- rule: Dar recomendación DESPUÉS de informar el año
  steps:
  - intent: informar_ano
  - action: action_recomendar_vino_db

- rule: Activar la búsqueda de tour por viña
  steps:
  - intent: buscar_tour_vina
  - action: action_buscar_tour

- rule: Activar la recomendación de tour
  steps:
  - intent: recomendar_tour
  - action: action_recomendar_tour_db

# === NOVEDAD: Rules de Perfil ===
- rule: Activar registro
  steps:
  - intent: registrar_usuario
  - action: action_registrar_usuario

- rule: Activar login
  steps:
  - intent: iniciar_sesion
  - action: action_iniciar_sesion

- rule: Guardar preferencia
  steps:
  - intent: guardar_preferencia_vino
  - action: action_guardar_preferencia

# === NOVEDAD: Regla actualizada para activar el Formulario ===
- rule: Activar formulario de valoración
  steps:
  - intent: valorar_tour
  - action: valorar_tour_form
  - active_loop: valorar_tour_form

# === NOVEDAD: Regla para manejar el envío del formulario ===
- rule: Enviar formulario de valoración
  condition:
  # La condición es que el formulario esté activo
  - active_loop: valorar_tour_form
  steps:
  # La acción 'valorar_tour_form' se llama
  - action: valorar_tour_form
  # El loop se desactiva
  - active_loop: null
  # (La lógica de guardado ahora estará en actions.py)

  # === NOVEDAD: Regla de Ayuda ===
- rule: Responder a la petición de ayuda
  steps:
  - intent: pedir_ayuda
  - action: utter_ayuda