version: "3.1"

# --- INTENTS (Intenciones que el bot debe reconocer) ---
intents:
  - saludar
  - despedirse
  - recomendar_vino
  - informar_gusto
  - buscar_tour_vina
  - recomendar_tour
  - informar_ano
  # === NOVEDAD: Intents de Perfil ===
  - registrar_usuario
  - iniciar_sesion
  - guardar_preferencia_vino
  - valorar_tour
# === NOVEDAD: Intent de Ayuda ===
  - pedir_ayuda

# --- ENTITIES (Entidades que el bot debe extraer del texto) ---
entities:
  - cepa
  - tipo_vino
  - valle
  - vina
  - sabor_nota
  - caracteristica
  - maridaje
  - ano
  # === NOVEDAD: Entidades de Perfil ===
  - email
  - password

# --- SLOTS (Variables donde se guarda la información) ---
slots:
  slot_cepa:
    type: text
    influence_conversation: true
    mappings: 
    - type: from_entity
      entity: cepa
      
  slot_tipo_vino:
    type: text
    influence_conversation: true
    mappings: 
    - type: from_entity
      entity: tipo_vino

  slot_valle:
    type: text
    influence_conversation: true
    mappings: 
    - type: from_entity
      entity: valle
      
  slot_vina:
    type: text
    influence_conversation: true
    mappings: 
    - type: from_entity
      entity: vina
  
  slot_caracteristica:
    type: text
    influence_conversation: true
    mappings: 
    - type: from_entity
      entity: caracteristica
      
  slot_maridaje:
    type: text
    influence_conversation: true
    mappings: 
    - type: from_entity
      entity: maridaje

  slot_ano:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: ano

  # === NOVEDAD: Slots de Sesión ===
  slot_email:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: email
  slot_password:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: password
  slot_user_id: # Guardará el ID del usuario logueado
    type: text
    influence_conversation: true
    mappings: [] # Se llena solo desde la action

# --- ACTIONS (Acciones que el bot puede ejecutar) ---
actions:
  - action_recomendar_vino_db
  - action_buscar_tour
  - action_recomendar_tour_db
  - utter_saludar
  - utter_despedirse
  - utter_pedir_gusto
  # === NOVEDAD: Actions de Perfil ===
  - action_registrar_usuario
  - action_iniciar_sesion
  - action_guardar_preferencia
  - action_valorar_tour
  # === NOVEDAD: Responses de Perfil ===
  - utter_pedir_email
  - utter_pedir_password
  - utter_ya_estas_logueado
  - utter_registro_exitoso
  - utter_login_exitoso
  - utter_login_fallido
  - utter_preferencia_guardada
  # === NOVEDAD: Action de Ayuda ===
  - utter_ayuda
  
# --- RESPONSES (Respuestas predefinidas del bot) ---
responses:
  utter_saludar:
    - text: "¡Hola! Soy VinAI, tu sommelier virtual. Puedes pedirme una recomendación de vino, buscar un tour o 'iniciar sesión' para usar tus preferencias guardadas."
  
  utter_despedirse:
    - text: "¡Adiós! Que tengas un excelente día y salud."
    
  utter_pedir_gusto:
    - text: "¡Claro! Para recomendarte el vino perfecto, ¿podrías decirme qué tipo de vino prefieres (tinto, blanco, etc.), alguna cepa o con qué comida lo vas a maridar?"

  # === NOVEDAD: Responses de Perfil ===
  utter_pedir_email:
    - text: "Perfecto, ¿cuál es tu email?"
  utter_pedir_password:
    - text: "Gracias, ¿cuál es tu contraseña?"
  utter_ya_estas_logueado:
    - text: "¡Ya has iniciado sesión!"
  utter_registro_exitoso:
    - text: "¡Genial! Tu cuenta ha sido creada. Ya puedes iniciar sesión."
  utter_login_exitoso:
    - text: "¡Bienvenido de nuevo! He iniciado sesión con tu cuenta."
  utter_login_fallido:
    - text: "Lo siento, no pude verificar tus credenciales. ¿El email y contraseña son correctos?"
  utter_preferencia_guardada:
    - text: "¡Entendido! He guardado esa preferencia en tu perfil."
    # === NOVEDAD: Response de Ayuda ===
  utter_ayuda:
    - text: "¡Claro! Soy VinAI, tu asistente de vinos y enoturismo. Puedo ayudarte con esto:<br><br>* **Recomendar Vinos:** Pídeme un vino por cepa, año, maridaje o características (ej. 'recomiéndame un tinto para carnes').<br>* **Buscar Tours:** Pregúntame por tours en una viña específica (ej. '¿qué tours hay en Santa Rita?').<br>* **Recomendar Tours:** Pídeme que te recomiende un tour por valle (ej. 'recomiéndame un tour en Colchagua').<br>* **Crear tu Perfil:** Escribe 'iniciar sesión' o 'registrarme' para guardar tus gustos.<br>* **Guardar Gustos:** Si iniciaste sesión, puedes decirme 'guarda que me gusta el Carmenere'.<br>* **Valorar Tours:** Si iniciaste sesión, puedes decir 'quiero valorar Montes con 5 estrellas'."